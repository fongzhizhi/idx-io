# T/DISA IDX协议扩展与实现说明

> **T/DISA**：《班级电子设计数据模型和接口》
>
> **IDX**：结构要素和交换数据模型

T/DISA IDX协议以 PSI 5 ECAD-MCAD - IDXv4.5 协议为基础，扩展了以下数据模型：

+ 限高区域
+ 净空区域
+ 空间堆叠板
+ 屏蔽罩
+ 盲埋孔
+ 元器件

**注**：*为了方便讨论，下文统一称T/DISA IDX协议为**扩展协议**，IDX v4.5协议为**IDX协议**。*

本文将对以上模型的实现从以下角度做相关补充说明：

+ 是否支持
+ 实现方案：数据模型的建模方案说明。
+ 数据定义：扩展数据的类型定义、约束定义。
+ 验证方式

## 总览

| 扩展       | 是否支持 | 实现方案                                                     | 验证方式       | 补充说明           |
| ---------- | -------- | ------------------------------------------------------------ | -------------- | ------------------ |
| 限高区域   | 原生支持 | 通过保持区域`KEEPIN_AREA_COMPONENT`实现，通过自定义属性`PackageHeightPurpose`标识。 | 模拟验证       | 无                 |
| 净空区域   | 原生支持 | 通过保持区域`KEEPIN_AREA_COMPONENT`实现，通过自定义属性`ClearancePupose`标识。 | 模拟验证       | 与扩展协议有差异。 |
| 空间堆叠板 | 模拟支持 | 通过新增两个更高层级装配体模拟实现：”板堆叠“装配和”PBC板“装配。 | 模拟验证       | 无                 |
| 屏蔽罩     | 原生支持 | 通过机械元件`COMPONENT_MECHANICAL`实现，通过自定义属性`ShieldingCanThickness`标识。 | 模拟验证       | 无                 |
|            |          |                                                              |                |                    |
|            |          |                                                              |                |                    |
| 盲埋孔     | 原生支持 | 通过IDX v4.5推荐的`assemblyToName`属性关联层堆叠；传统方式通过自定义属性`StartLayerNumber`和`EndLayerNumber`属性标识。 | JLCEDA导出验证 | 与扩展协议有差异。 |
| 元器件     | 原生支持 | 通过自定义属性 `ElectricComponentType`标识电气元器件类型、 `MechanicalComponentType`标识机械元器件类型。 | JLCEDA导出验证 | 无                 |

更多细节请参考下文。

## 限高区域

> 限高区域是在PCB板上对元器件高度进行限制的区域，其布局设计主要目是为了避免元器件之间相互干扰，确保电路的可靠性和散热性能。

### 是否支持

原生支持。

### 实现方案

根据扩展协议要求，使用保持区域实现，类型为`KEEPIN_AREA_COMPONENT`（元件保持区域），然后增加自定义属性限高目的（PackageHeightPurpose）进行标识即可。

### 数据定义

与扩展协议中一致：

| 属性类别 | 中文名称 | 英文名称             | 定义               | 值类型 | 长度   | 是否必需 | 约束   | 备注 |
| -------- | -------- | -------------------- | ------------------ | ------ | ------ | -------- | ------ | ---- |
| 值属性   | 限高目的 | PackageHeightPurpose | 限高区域的限高目的 | 字符串 | 不涉及 | 是       | 枚举值 | 无   |

`PackageHeightPurpose`的枚举值：

| 枚举值                        | 说明           |
| ----------------------------- | -------------- |
| Thermal                       | 散热区域       |
| Shock                         | 防电击区域     |
| Vibration                     | 防振动区域     |
| Electromagnetic Compatibility | 防电磁干扰区域 |
| Other                         | 未定义         |

### 验证方式

**模拟验证**：JLCEDA PCB板无此数据。

## 净空区域

> 净空区域是在PCB板上为特定元器件或区域预留一定空间，以确保器正常工作，避免干扰和确认按照的可靠性等。

### 是否支持

原生支持。同限高区域类似。

### 实现方案

**与扩展协议有出入**，协议要求使用KeepOutArea，但这在IDX官方协议中，应该是禁止放置区域，净空区域不是禁止放置，相反，和限高区域一样，是需要放置元件的区域，因此应该同样使用`KEEPIN_AREA_COMPONENT`（元件保持区域），然后增加自定义属性净空目的（ClearancePupose）进行标识即可。

### 数据定义

与扩展协议中一致：

| 属性类别 | 中文名称 | 英文名称        | 定义               | 值类型 | 长度   | 是否必需 | 约束   | 备注 |
| -------- | -------- | --------------- | ------------------ | ------ | ------ | -------- | ------ | ---- |
| 值属性   | 净空目的 | ClearancePupose | 净空区域的净空目的 | 字符串 | 不涉及 | 是       | 枚举值 | 无   |

`ClearancePupose`的枚举值：

| 枚举值           | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| AntennaClearance | 天线净空，指在PCB板上，为天线辐射体预留的一个立体三维的无铜区域。 |
| SurfaceClearance | 表层净空，指仅在PCB的最外层（表面层）不布置铜消(信号线、电源、覆铜)，但保留其正下方相邻内层的完整地平面。 |
| FullClearance    | 完全净空，指在PCB的所有层，包括顶层、底层和所有内层，在某一特定区域内全部挖空，不布置任何形式的铜消（信号线、电源、地平面）。 |
| Other            | 未定义                                                       |

### 验证方式

**模拟验证**：JLCEDA PCB板无此数据。

## 空间堆叠板

> 空间堆叠板是一种将多个PCB板通过特定方式堆叠起来，以实现更紧凑的结构和更高效的功能集成的设计方法。如手机主板“三明治”结构，是通过在主板上垂直堆益一个子板，形成“两层三面”结构，在“三面”上实现容纳更多功能元器件三维布局。

### 是否支持

模拟支持。非官方原生支持，IDX协议是单PCB板协议，多个PCB板堆叠形成的板堆叠可通过`Item(Assembly)`装配体来模拟实现，只能保证语法上不违反IDX格式规范。

*特别说明：此处称之为"板堆叠"，而不是扩展协议中称谓的"堆叠板"，是基于IDX协议中类似“堆叠层”和“层堆叠”的概念：层堆叠（**Layer Stackup**）描述构成一块物理PCB的材料层的垂直顺序、类型和厚度，而堆叠层（**Stacked Laye**）特指层堆叠中的一个成员层。板堆叠概念同理，强调的堆叠效果和整体效果。*

### 实现方案

官方IDX协议并没有定义“板堆叠”，因此一般用装配`Item(assembly)`来表达。

比如：“板堆叠” = "主板" + "子板"，类似这样的结构：

```txt
SPACE_STACK_ASSEMBLY (顶级装配: 板堆叠)
├── MAIN_BOARD_ASSEMBLY (中间层装配：PCB主板)
│   ├── MAIN_BOARD_INSTANCE (板子实例)
|	└── ...其他板内实例
└── SUB_BOARD_ASSEMBLY (中间层装配：PCB子板)
    ├── SUB_BOARD_INSTANCE (板子实例)
    |	└── ...其他板内实例
```

这样能保证板内的其他数据结构不变，只是新增了两个更高层级的装配：

+ 每个独立的PCB（主板、子板）是一个**子装配体**，内部包含该板子的各种板内装配体：板子、组件、孔、禁布区等。
+ 顶层是一个**总装配体**，通过3D变换（`Transformation`）关系将这些子装配体在空间中进行定位，从而实现 **“堆叠”**。

### 数据定义

无。不过为了识别板堆叠装配和PCB板装配，可像限高区域和净空区域一样，增加特殊自定义属性作为标识。

### 验证方式

**模拟验证**：JLCEDA PCB板无此数据。

## 屏蔽罩

> 屏蔽罩主要用于电磁兼容性设计，以防止外部电磁干扰影响电子设备内部电路的正常工作，同时避免设备自身产生的电磁干扰影响外部环境。

### 是否支持

原生支持。

### 实现方案

屏蔽罩就是特殊的机械元件，因此使用`COMPONENT_MECHANICAL`类型，然后增加自定义属性屏蔽罩厚度（ShieldingCanThickness）进行标识即可。

### 数据定义

与扩展协议中一致：

| 属性类别 | 中文名称   | 英文名称              | 定义               | 值类型 | 长度  | 是否必需 | 约束 | 备注 |
| -------- | ---------- | --------------------- | ------------------ | ------ | ----- | -------- | ---- | ---- |
| 值属性   | 屏蔽罩厚度 | ShieldingCanThickness | 净空区域的净空目的 | 浮点数 | 8字节 | 是       | 无   | 无   |

### 验证方式

**模拟验证**：JLCEDA PCB板无此数据。

## 盲埋孔

> 盲埋孔（BVH）是盲孔（BLindVia）和埋孔（BuiedVia）的统称，盲孔是从 PCB 的一个表面开始，向下延伸到内部的某一特定层。埋孔位于PCB 的内部，被周围的绝缘材料和导电层所包围，不与PCB 的任何表面（顶层或底层）相连。

### 是否支持

原生支持。

### 实现方案

盲埋孔是IDX协议原生支持的，通过`assemblyToName`属性关联指定层堆叠，就能表达盲埋孔的起始层和终止层信息。

如果是使用传统建模方式，即通过Z轴边界定义位置，确实没有明确的层范围信息，在扩展协议中一样，通过添加自定义属性来表达：

+ StartLayerNumber
+ EndLayerNumber

不过，根据数层的方式可能**并不稳定**，因为一旦层堆叠的层数量和层顺序发生变化，上述两种属性就需要重新计算。

因此，此处实现改为通过关联层ID实现：

+ StartLayer
+ EndLayer

### 数据定义

同扩展协议一致：

| 属性类别 | 中文名称 | 英文名称   | 定义         | 值类型 | 长度  | 是否必需 | 约束 | 备注 |
| -------- | -------- | ---------- | ------------ | ------ | ----- | -------- | ---- | ---- |
| 值属性   | 起始层ID | StartLayer | 层的唯一标识 | 字符串 | 8字节 | 是       | 无   | 无   |
| 值属性   | 终止层ID | EndLayer   | 层的唯一标识 | 字符串 | 8字节 | 是       | 无   | 无   |

### 验证方式

JLCEDA导出验证。

## 元器件

### 是否支持

原生支持。

### 实现方案

元件是IDX协议原生支持的两种装配类型：

+ `COMPONENT`：电气元件：标准电气元件（电阻、电容、IC等）。
+ `COMPONENT_MECHANICAL`：机械元件：非电气元件（散热器、安装支架等）。

扩展协议是希望**更细致的分类**，因此同样增加自定义属性来实现：

+ `ElectricComponentType`：电气元器件类型。
+ `MechanicalComponentType`：机械元器件类型。

### 数据定义

电气元器件类型枚举：

| 枚举值                       | 含义           |
| ---------------------------- | -------------- |
| Resistor                     | 电阻器         |
| Capacitor                    | 电容器         |
| Inductor                     | 电感器         |
| Transformer                  | 变压器         |
| PassiveFilter                | 无源滤波器     |
| Oscillator                   | 振荡器         |
| ElectroacousticDevice        | 电声器件       |
| Relay                        | 继电器         |
| Switch                       | 开关           |
| CircuitProtector             | 电路保护器     |
| Connerctor                   | 连接器         |
| Cable                        | 线缆           |
| PhotoelectronicDevice        | 光电子器件     |
| SensitiveElement             | 敏感元器件     |
| Sensor                       | 传感器         |
| DiscreteSemiconductorDevices | 半导体分立器件 |
| IntegratedCircuit            | 集成电路       |
| ShieldingCan                 | 屏蔽罩         |
| Other                        | 其他           |

机械元器件类型枚举：

| 枚举值          | 含义       |
| --------------- | ---------- |
| ProtectiveCover | 保护盖     |
| PinchPlate      | 扣板       |
| Bracket         | 支架       |
| SocketConnector | 接插件     |
| CardExtractors  | 虎片提取器 |
| Stiffeners      | 加强器     |
| Heatsinks       | 散热器     |
| Other           | 其他       |

### 验证方式

JLCEDA导出验证。